<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Выбор фотографий</title>
    <style>
        .images_wrapper {
            gap: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 3px;
        }

        .image_container {
            display: inline-block;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border 0.3s ease;
        }

        .image_container.selected {
            border: 3px solid green;
        }

        .image_container input[type="checkbox"] {
            display: none;
        }

        .fixed_button_container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 999;
            padding-top: 5px;
        }

        .fixed_button_container button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .images_form {
            padding-bottom: 40px;
        }
        .image_description {
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <h2>Выберите фотографии</h2>
    <form action="/select_photos" method="post" class="images_form">
        <div class="images_wrapper">
        {% for image in prepared_images %}
            <div class="image_container">
                <img src="{{ image.path }}" alt="Photo">
                <p class="image_description">Tags: {{ image.description }}</p>
                <input type="checkbox" name="selected_photos_ids" value="{{ image.id }}">
            </div>
        {% endfor %}
        </div>
        <div class="fixed_button_container">
            <button type="submit">Подтвердить выбор (<span id="selected-count">0</span>)</button>
        </div>
    </form>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log(window.Telegram);
            const telegram = window.Telegram.WebApp;
            const user = telegram.initDataUnsafe?.user;

            if (user) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'telegram_user_id';
                input.value = user.id;
                document.querySelector('form').appendChild(input);
            }
            const containers = document.querySelectorAll('.image_container');
            const counter = document.getElementById('selected-count');

            function updateCounter() {
                counter.textContent = document.querySelectorAll('.image_container input[type="checkbox"]:checked').length;
            }

            containers.forEach(container => {
                container.addEventListener('click', () => {
                    const checkbox = container.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    container.classList.toggle('selected', checkbox.checked);
                    updateCounter();
                });
            });

            updateCounter();
        });
    </script>
</body>
</html>